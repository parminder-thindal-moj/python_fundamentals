# Check Py files GitHub Action config file
name: CheckPythonFiles

on:
  workflow_call:
    outputs:
      py_files_changed:
        description: 'Check if py files have changed.'
        value: ${{ jobs.check_py_files.outputs.py_files_changed }}

jobs:
  check_py_files:
    runs-on: ubuntu-latest
    outputs:
      py_files_changed: ${{ steps.check.outputs.py_files_changed }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
            fetch-depth: 0

      - name: Check for changed py files in classes or functions.
        id: check
        env:
          PREVIOUS_COMMIT: ${{ github.event.before }}
          CURRENT_COMMIT: ${{ github.event.sha }}
        run: |
          set -euxo pipefail
          echo "$PREVIOUS_COMMIT"
          echo "$CURRENT_COMMIT"

          files=$(git diff --name-only $CURRENT_COMMIT $PREVIOUS_COMMIT | grep -E '^classes/.*\.py$|^functions/.*\.py$')

      - name: Get changed Python files in classes folder
        id: changed-files
        uses: tj-actions/changed-files@v44
        with:
          files: |
            classes/**/*.py
      
      - name: Run step if any Python files in folder_a have changed
        if: steps.changed-files.outputs.any_changed == 'true'
        run: |
          echo "One or more Python files in folder_a has changed."
          # Add additional steps here to handle the change, e.g., running tests, deploying, etc.
